---
priority: domain
applies_to: article-writing tools (ai-article-writer, ai-article-composer, ai-complexity-adapter, ai-text-generator, ai-diagram-generator)
conflicts_with: none
examples: see Examples section below
---

# AI Article Writer Rules

**IMPORTANT**: These rules apply to all article-writing tools in the `tools/ai/` directory.

## Implementation Status

**‚úÖ COMPLETED (November 2024):**
- Article generation with 3 difficulty levels (simple, medium, advanced)
- Interactive HTML viewer with per-section difficulty switching
- Markdown article generation with complexity annotations
- GitHub Pages deployment setup
- Node.js/JavaScript implementation
- PowerShell scripts for Windows
- Cross-platform Node.js scripts

**üìÅ Key Files:**
- `tools/ai/ai-article-writer/src/index.js` - Main article generator
- `tools/ai/ai-article-writer/src/article-viewer.js` - HTML viewer generator
- `docs/ai-first-repository-guide.html` - Example output (live on GitHub Pages)
- `docs/ai-first-repository-guide.md` - Example markdown source

**‚è≥ FUTURE ENHANCEMENTS:**
- AI-powered content generation (currently uses template content)
- Diagram generation integration (Mermaid)
- MCP server integration
- Advanced template system
- Content caching and optimization

## Technology Stack

### Core Stack
- **Runtime**: Node.js (v18+ recommended)
- **Language**: JavaScript (ES6+)
- **UI**: HTML/CSS for any web interfaces
- **Package Manager**: npm (or yarn/pnpm if specified)
- **Scripts**: PowerShell for Windows, Bash for Linux/Mac

### Why JavaScript/Node.js?
- Better integration with web-based AI tools and APIs
- Easier HTML/CSS manipulation for article formatting
- Rich ecosystem for markdown processing
- Better suited for async operations (API calls, file I/O)
- User preference for this particular task

## Tool Structure

### Standard Directory Layout
```
tools/ai/{tool-name}/
‚îú‚îÄ‚îÄ MANIFEST.json          # Tool metadata (must specify Node.js runtime)
‚îú‚îÄ‚îÄ README.md              # Tool documentation
‚îú‚îÄ‚îÄ package.json           # Node.js dependencies (NOT requirements.txt)
‚îú‚îÄ‚îÄ scripts/               # PowerShell/Bash scripts
‚îÇ   ‚îî‚îÄ‚îÄ {tool-name}.ps1    # Main entry point
‚îî‚îÄ‚îÄ src/                   # JavaScript source code (optional)
    ‚îî‚îÄ‚îÄ index.js           # Main implementation
```

### Package.json Requirements
- **Must include**: `name`, `version`, `description`, `main`, `scripts`
- **Must specify**: Node.js version requirement (`engines.node`)
- **Dependencies**: Use npm packages, not Python packages
- **Scripts**: Define npm scripts for common operations

### Manifest Updates
When updating `MANIFEST.json`:
- **Runtime**: Change from `["python"]` to `["node", "npm"]`
- **External dependencies**: List npm packages, not Python packages
- **Entry points**: PowerShell scripts that call Node.js scripts
- **Location**: Remove `venv_path` and `requirements`, add `package_json` path

## Development Patterns

### Script Structure
PowerShell scripts should:
1. Check for Node.js installation
2. Check for npm dependencies (run `npm install` if needed)
3. Call Node.js scripts with proper arguments
4. Handle errors gracefully

Example pattern:
```powershell
# Check Node.js
if (-not (Get-Command node -ErrorAction SilentlyContinue)) {
    Write-Error "Node.js is required but not installed."
    exit 1
}

# Install dependencies if needed
if (-not (Test-Path "node_modules")) {
    Write-Host "Installing dependencies..." -ForegroundColor Cyan
    npm install
}

# Run Node.js script
node src/index.js @args
```

### JavaScript Code Style
- Use ES6+ features (async/await, arrow functions, destructuring)
- Use `const`/`let` instead of `var`
- Follow Node.js conventions (CommonJS or ES modules)
- Handle errors with try/catch
- Use async/await for file operations

### File Operations
- Use `fs/promises` for async file operations
- Use `path` module for cross-platform paths
- Use `process.argv` or argument parsing libraries for CLI args

## Integration Points

### With Other Tools
- Article Writer coordinates: text-generator, diagram-generator, complexity-adapter, composer
- All tools use Node.js runtime
- Communication via JSON files or CLI arguments
- Shared utilities can be in a common `lib/` directory

### With Cursor AI
- Tools should produce clear, parseable output
- Error messages should be structured and actionable
- Progress indicators for long-running operations
- Support for streaming output when possible

## Complexity Levels

### Three Difficulty Levels
1. **Simple**: Beginner-friendly, minimal jargon, step-by-step
2. **Medium**: Intermediate, assumes some knowledge, balanced detail
3. **Advanced**: Expert-level, technical depth, assumes expertise

### Implementation
- Each paragraph/section should have three versions
- Store in structured format (JSON or Markdown with annotations)
- UI can toggle between levels (hover or tabs)
- Complexity adapter tool handles conversion

## Examples

### Good: Node.js Implementation
```javascript
// src/index.js
const fs = require('fs/promises');
const path = require('path');

async function generateArticle(topic, outputPath) {
    // Implementation
}
```

### Bad: Python Implementation
```python
# Don't use Python for article-writing tools
import yaml
# ...
```

### Good: Package.json
```json
{
  "name": "ai-article-writer",
  "version": "0.1.0",
  "main": "src/index.js",
  "engines": {
    "node": ">=18.0.0"
  },
  "scripts": {
    "start": "node src/index.js"
  },
  "dependencies": {
    "markdown": "^0.5.0"
  }
}
```

### Bad: requirements.txt
```
# Don't use Python requirements.txt
markdown==0.5.0
```

## Migration Notes

When migrating from Python to Node.js:
1. Replace `requirements.txt` with `package.json`
2. Update `MANIFEST.json` runtime dependencies
3. Rewrite Python scripts in JavaScript
4. Update PowerShell scripts to call Node.js
5. Remove `.venv` references
6. Update documentation

## Current Implementation Details

### Article Generator (`src/index.js`)
- Generates markdown articles with 3 complexity levels per section
- Uses HTML comments to annotate complexity: `<!-- simple:start -->` ... `<!-- simple:end -->`
- Creates YAML frontmatter with metadata
- Currently uses template content (ready for AI integration)

### HTML Viewer (`src/article-viewer.js`)
- Parses markdown articles with complexity annotations
- Generates interactive HTML with per-section difficulty buttons
- Includes global controls to set all sections to one difficulty
- Responsive design, GitHub Pages ready

### GitHub Pages Setup
- Includes `.nojekyll` file to prevent Jekyll processing
- Includes `index.html` redirect
- Fixed submodule issues (removed invalid submodule reference)
- Deployed at: https://sosotughushi.github.io/ElectricSheep/ai-first-repository-guide.html

### GitHub Pages Deployment Workflow
**CRITICAL**: When updating articles, always push changes so GitHub Pages can pick them up:

1. **After generating/updating article markdown**:
   - Regenerate HTML: `node tools/ai/ai-article-writer/src/article-viewer.js --markdown docs/article.md --output docs/article.html`
   - Commit both `.md` and `.html` files together
   - Push to `master` branch: `git push origin master`
   - GitHub Pages will automatically rebuild (may take 1-5 minutes)

2. **Files that must be committed**:
   - `docs/*.md` - Source markdown articles
   - `docs/*.html` - Generated HTML viewers
   - `tools/ai/ai-article-writer/src/*.js` - Viewer generator updates
   - `tools/ai/ai-article-writer/package.json` - Dependency updates

3. **Never commit**:
   - `node_modules/` - Dependencies (gitignored)
   - Temporary files or logs

4. **Verification**:
   - Check GitHub Actions (if enabled) for deployment status
   - Wait 1-5 minutes after push, then verify at GitHub Pages URL
   - Use local preview (see below) before pushing to catch issues early

## Common Pitfalls and Solutions

### ‚ö†Ô∏è Template Literal Escaping Issues

**Problem**: When generating JavaScript code inside template literals, nested template literals and regex patterns can cause syntax errors.

**Solutions**:
- **Avoid nested template literals**: Use string concatenation instead of nested backticks
  ```javascript
  // ‚ùå BAD: Nested template literal
  const buttons = document.querySelectorAll(\`[data-section="\${sectionIndex}"]\`);
  
  // ‚úÖ GOOD: String concatenation
  const buttons = document.querySelectorAll('[data-section="' + sectionIndex + '"]');
  ```

- **Avoid regex literals in template strings**: Use `RegExp` constructor or string methods
  ```javascript
  // ‚ùå BAD: Regex literal in template string breaks
  .replace(/\n/g, '<br>')
  
  // ‚úÖ GOOD: Use string methods
  .split('\\n').join('<br>')
  
  // ‚úÖ GOOD: Or use RegExp constructor with escaped strings
  const newlineRegex = new RegExp('\\n', 'g');
  ```

- **Backticks in template strings**: Use `String.fromCharCode(96)` instead
  ```javascript
  // ‚ùå BAD: Backtick breaks template literal
  .split('`')
  
  // ‚úÖ GOOD: Use character code
  const backtick = String.fromCharCode(96);
  .split(backtick)
  ```

### ‚ö†Ô∏è Function Definition Order

**Problem**: JavaScript functions must be defined before they're called, especially in generated HTML.

**Solution**: Always define functions before initialization code:
```javascript
// ‚úÖ GOOD: Define first, then initialize
function setDifficulty(...) { ... }
function setAllSections(...) { ... }

// Then initialize
articleData.forEach((section, index) => {
    setDifficulty(index, defaultDifficulties[index]);
});
```

### ‚ö†Ô∏è HTTP Server Setup

**Problem**: Server must run from the correct directory, and user prefers Node.js over Python.

**Solutions**:
- **Always use Node.js**: Use `npx http-server` or `node` for HTTP servers, not Python
- **Run from correct directory**: Server must run from `docs/` directory, not repo root
- **Check file paths**: Verify HTML files exist before starting server

**Correct pattern**:
```bash
cd docs && npx -y http-server -p 8080 -o article.html
```

### ‚ö†Ô∏è Markdown Rendering

**Problem**: When marked.js isn't available, fallback rendering must work without regex issues.

**Solution**: Use simple string methods for fallback:
```javascript
// ‚úÖ GOOD: Simple, no regex
let result = content.split('\\n').join('<br>');
result = result.split('**').map((part, i) => 
    i % 2 === 1 ? '<strong>' + part + '</strong>' : part
).join('');
```

### ‚ö†Ô∏è Testing Workflow

**Always test locally before pushing**:
1. Regenerate HTML: `node tools/ai/ai-article-writer/src/article-viewer.js --markdown docs/article.md --output docs/article.html`
2. Preview locally: `./tools/ai/ai-article-writer/scripts/preview-article.sh --regenerate`
3. Verify functionality (buttons work, no console errors)
4. Then commit and push

## Next Steps for AI Agents

When continuing work on this tool:
1. **Read**: `tools/ai/ai-article-writer/README.md` for current status
2. **Check**: `src/index.js` to see how articles are generated
3. **Enhance**: Replace template content with AI-generated content (Cursor API integration)
4. **Extend**: Add diagram generation using Mermaid.js
5. **Integrate**: Add MCP server operations for remote access
6. **Remember**: Always test locally before pushing, avoid template literal pitfalls

## Related Rules
- `development-workflow.cursorrules` - General development practices
- `mcp-tool-integration.cursorrules` - Tool integration patterns
- `error-handling.cursorrules` - Error handling patterns

